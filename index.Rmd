---
title: "ETC5521 Assignment 1"
subtitle: "Your title"
team: taipan
author:
  - Helen Evangelina
  - Yiwen Jiang
date: "`r Sys.Date()`"
output: 
  html_document
---

```{r setup, echo=FALSE}
library(tidyverse)
library(kableExtra)
library(lubridate)
library(dplyr)
```


[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}


# Introduction and motivation

This report presents the findings of the current status of woodland caribou following the tracking conducted under B.C. Ministry of Environment & Climate Change. In this research, mainly analysis the changes in the number of woodland caribou, other analysis include the habitat changes caused by seasonal differences, the effects of the implementation of management plans and the causes of tag deployment ended. In the following section, we will describe the data set, where the data came from, and what is the data prepared for. The data description also includes how we transform and clean the raw data for analysis. Our statistical programming used for analysis is R and Rstudio.

## Motivation

Caribou are the only large herbivore that is widely distributed in the high-elevation habitat and act as agents for plant and lichen diversity through the mechanisms of trampling and foraging. The caribou have also been a significant resource for indigenous peoples for millennia. (BC Ministry of Environment (2014)). The survival rate of caribou is generally quite low due to predation by Canis Lupus (wolf) which was listed as "vulnerable" on the International Union for Conservation of Nature (IUCN) Red List.

## Data Sources
The tracking data was collected by B.C. Ministry of Environment & Climate Change over 38 years (1988 - 2016), the data was prepared for the study of management and recovery of the caribou. It includes the information of 260 caribou and covered 250,000 locations.

## Data Limitation 

# Data description

## Overview of the dataset
The dataset tracks woodland caribou in northern British Columbia published by the Movebank Data Repository at https://www.datarepository.movebank.org/handle/10255/move.955. This data was collected by putting trackers of almost 250,000 location tags on 260 caribou, from 1988 to 2016, which was accessed through Movebank. 

The boreal woodland caribou (Rangifer tarandus caribou), also known as woodland caribou, boreal forest caribou and forest-dwelling caribou, is a North American subspecies of the reindeer (or the caribou in North America) with the vast majority of animals in Canada. They prefer lichen-rich mature forests and mainly live in marshes, bogs, lakes and river regions. Caribou are considered as an ancient member of the deer family Cervidae (Banfield, 1974). They are smaller than Moose (Alces americanus) and Elk (Cervus canadensis), standing 1.0–1.2 m high at the shoulder (Thomas and Gray, 2002). Due to the caribou is classified as "Vulnerable" on the International Union for the Conservation of Nature's (IUCN) Red List. The data provided for the study of the B.C. Ministry of Environment & Climate Change to report the management and recovery of the caribou.  

Because this data set is used for analysing the reproduction of species, the data is obtained by observation rather than experiment. There is no treatment group and the control group. The time frame of collection was started from 1988 and end of 2016. Movebank captures the locations of individual animals over time by tracking the bio-logging sensors attached to animals (Kranstauber et al., 2011). The data sets were separated into two data files and provided by .csv format. The following are the variables in each data.  

- The `individual` data comes from _Mountain caribou in British Columbia-reference-data.csv_. The data contains the relevant information of 286 caribou. The variables are showing in the following table: 

```{r individual_table, echo=FALSE}
individual_info <- tibble(Variable = c("animal_id", "sex", "life_stage", "pregnant", "with_calf", 
                                       "death_cause", "study_site", "deploy_on_longitude", 
                                       "deploy_on_latitude", "deploy_on_comments", "deploy_off_longitude",
                                       "deploy_off_latitude", "deploy_off_type", "deploy_off_comments"),
                          Class = c("character", "character", "character", 
                                    "logical", "logical", "character", "character", 
                                    "double", "double", "character", "double", 
                                    "double", "character", "character"),
                          Description = c("Individual identifier for animal", "Sex of animal", 
                                          "Age class (in years) at beginning of deployment", 
                                          "Whether animal was pregnant at beginning of deployment", 
                                          "Whether animal had a calf at time of deployment", 
                                          "Cause of death",
                                          "Deployment site or colony, or a location-related group such as the herd or pack name",
                                          "Longitude where animal was released at beginning of deployment",
                                          "Latitude where animal was released at beginning of deployment",
                                          "Additional information about tag deployment",
                                          "Longitude where deployment ended",
                                          "Latitude where deployment ended",
                                          "Classification of tag deployment end (see table below for full description", 
                                          "Additional information about tag deployment end")) 

kable(individual_info) %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "left")
```

- The `location` comes from _Mountain caribou in British Columbia-gps.csv_. The data contains location information of each counted caribous for every 4 fours.

```{r locations_table, echo=FALSE}
locations_info <- tibble(Variable = c("event_id", "animal_id", "study_site", "season", "timestamp", "longitude", "latitude"),
                          Class = c("double", "character", "character", "character", "datetime", "double", "double"),
                          Description = c("Identifier for an individual measurement", 
                                          "Individual identifier for animal", 
                                          "Deployment site or colony, or a location-related group such as the herd or pack name", 
                                          "Season (Summer/Winter) at time of measurement", 
                                          "Date and time of measurement",
                                          "Longitude of measurement",
                                          "Latitude of measurement")) 

kable(locations_info) %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "left")
```

```{r read_data}
# Get the Data

individuals <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-23/individuals.csv')
locations <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-23/locations.csv')

# Or read in with tidytuesdayR package (https://github.com/thebioengineer/tidytuesdayR)

# Either ISO-8601 date or year/week works!

# Install via devtools::install_github("thebioengineer/tidytuesdayR")

tuesdata <- tidytuesdayR::tt_load('2020-06-23')
tuesdata <- tidytuesdayR::tt_load(2020, week = 26)


individuals <- tuesdata$individuals
```
## Data cleaning processes
The data being used is the dataset from the Science update for the South Peace Northern Caribou (Rangifer tarandus caribou pop. 15) in British Columbia available from Movebank (BC Ministry of Environment, 2014). The raw datasets are first read by using read_csv() function. It can be noticed from the raw datasets that the variable names use “-“ instead of “_”. Using dash in a variable name might result to issues, as the valid variable name in R should consist of dot or underline characters. Another problem from this dataset is the values in the “animal-life-stage” consist of spacing, which might lead to issues as it is inconsistent. Another noticeable thing is the datasets have a lot of NA values. Therefore, the data needs to be cleaned by using the tidyverse and janitor libraries.

To clean the individuals data, firstly clean_names() function from the janitor package is used to return the data.frame with clean names.  What this function does is changing the variable names into a tidier form. As mentioned before, using dash in variable names is not appropriate in R. Notice that the raw dataset has names like “deploy-off-latitude” which is changed into “deploy_off_latitude”.  Next is to assigned the result to transmute(), which will compute new columns but will drop existing columns. This is done to make the variable names in a tidier way. The whitespace in the life stage is gotten rid to address inconsistent spacing by using str_remove_all() function. After tidying the variable names with transmute, the “reproductive_condition” variable is separated into “pregnant” and “with_calf” by using the separate() function as this variable actually contains two dimensions, and then assigning those variables into new columns by using the mutate() function which consists of either TRUE or FALSE value.

The locations data is cleaned by using the same method as the individuals data, which includes cleaning the name first by using clean_names() function to arrive to a data.frame with clean names. The next step is to use transmute() function to compute new columns with dropping existing columns. After cleaning both datasets, the final datasets are written into csv format by using write_csv() function.

```{r data_cleaning, eval=FALSE}
# Load libraries
library(tidyverse)
library(janitor)

# Import data
individuals_raw <- read_csv("./caribou-location-tracking/raw/Mountain caribou in British Columbia-reference-data.csv")
locations_raw <- read_csv("./caribou-location-tracking/raw/Mountain caribou in British Columbia-gps.csv")

# Clean individuals
individuals <- individuals_raw %>%
  clean_names() %>%
  transmute(animal_id,
            sex = animal_sex,
            # Getting rid of whitespace to address inconsistent spacing
            # NOTE: life stage is as of the beginning of deployment
            life_stage = str_remove_all(animal_life_stage, " "),
            reproductive_condition = animal_reproductive_condition,
            # Cause of death "cod" is embedded in a comment field
            death_cause = str_remove(animal_death_comments, ".*cod "),
            study_site,
            deploy_on_longitude,
            deploy_on_latitude,
            # Renaming to maintain consistency "deploy_on_FIELD" and "deploy_off_FIELD"
            deploy_on_comments = deployment_comments,
            deploy_off_longitude,
            deploy_off_latitude,
            deploy_off_type = deployment_end_type,
            deploy_off_comments = deployment_end_comments) %>%
  # reproductive_condition actually has two dimensions
  separate(reproductive_condition, into = c("pregnant", "with_calf"), sep = ";", fill = "left") %>%
  mutate(pregnant = str_remove(pregnant, "pregnant: ?"),
         with_calf = str_remove(with_calf, "with calf: ?")) %>%
  # TRUE and FALSE are indicated by Yes/No or Y/N
  mutate_at(vars(pregnant:with_calf), ~ case_when(str_detect(., "Y") ~ TRUE,
                                                   str_detect(., "N") ~ FALSE,
                                                   TRUE ~ NA))

# Clean locations
locations <- locations_raw %>%
  clean_names() %>%
  transmute(event_id,
            animal_id = individual_local_identifier,
            study_site = comments,
            season = study_specific_measurement,
            timestamp,
            longitude = location_long,
            latitude = location_lat)

# Write to CSV
write_csv(individuals, "./caribou-location-tracking/individuals.csv")
write_csv(locations, "./caribou-location-tracking/locations.csv")
```

## Possible questions
This dataset is primarily used to analyse the changes in the number of caribou from 1988 to 2016 to observe the survival of the species. As the management came up with a plan, we would like to analyse whether the management plan is effective in increasing the number of caribou over time.

The primary question to answer from this dataset is __how is the trend of the number of caribou over time?__

From the primary question, we came up with four secondary questions, which are as follows:
- What can we learn about the population change and sex ratio of the caribou?  
- Does the location vary between summer and winter?  
- How is the trend of the classification of tag deployment end (deploy_off_type)?  
- Has the management plan increased the number of caribou?  

# Analysis and findings


[FILL] Should include at least one plot or numerical summary for each of your questions, that helps the reader arrive at an answer. You should also write paragraphs describing the methods, summaries and findings. 

## Question 3: How is the trend of the classification of tag deployment end (deploy_off_type)?

•	By analysising the classification of tag deployment end to decided whether the management plan is efficient to increase the number of caribou and whether have to modify the tracking method, such as if there is a large proportion of tag deployment end due to the equipment failure, they have to decided to improve the quality of the tag


## Question 4: Has the management plan increased the number of caribou?

•	According to the  Peace Northern Caribou Plan endorsed in  November 2012. The goal is to increase the South Peace Northern Caribou to 1,200 animals within 21 years.  By using the data sets we can analysis whether the trend of the number of animals are increasing in the previous years, and also is it possible to achieve the in 2032

```{r}
class(locations$timestamp)
```


```{r}
locations_wrangled <- locations %>%
  mutate(month = month(timestamp),
         day = day(timestamp),
         date = date(timestamp))
```

i wanna calculate how many unique animal_id are there per day or per month --> to see the trend of number of  caribou (if its increasing or not)

```{r}
locations_summary <- locations_wrangled %>% 
  group_by(date) %>%
  summarise(animals = unique(animal_id))
```


# References
