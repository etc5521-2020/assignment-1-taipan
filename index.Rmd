---
title: "ETC5521 Assignment 1"
subtitle: "Your title"
team: taipan
author:
  - Helen Evangelina
  - Yiwen Jiang
date: "`r Sys.Date()`"
output: 
  bookdown::html_document2
---

```{r setup, echo=FALSE}
library(tidyverse)
library(kableExtra)
library(lubridate)
library(dplyr)
library(bookdown)
library(plotly)
```


[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}


# Introduction and motivation

[FILL] Give the bigger picture of the data, and inspire the reader to learn more about the problem by reading your analysis. 

# Data description

## Overview of the dataset
The dataset tracks woodland caribou in northern British Columbia published by the Movebank Data Repository at https://www.datarepository.movebank.org/handle/10255/move.955. This data was collected by putting trackers of almost 250,000 location tags on 260 caribou, from 1988 to 2016, which was accessed through Movebank. 

The boreal woodland caribou (Rangifer tarandus caribou), also known as woodland caribou, boreal forest caribou and forest-dwelling caribou, is a North American subspecies of the reindeer (or the caribou in North America) with the vast majority of animals in Canada. They prefer lichen-rich mature forests and mainly live in marshes, bogs, lakes and river regions. Caribou are considered as an ancient member of the deer family Cervidae (Banfield, 1974). They are smaller than Moose (Alces americanus) and Elk (Cervus canadensis), standing 1.0–1.2 m high at the shoulder (Thomas and Gray, 2002). Due to the caribou is classified as "Vulnerable" on the International Union for the Conservation of Nature's (IUCN) Red List. The data provided for the study of the B.C. Ministry of Environment & Climate Change to report the management and recovery of the caribou.  

Because this data set is used for analysing the reproduction of species, the data is obtained by observation rather than experiment. There is no treatment group and the control group. The time frame of collection was started from 1988 and end of 2016. Movebank captures the locations of individual animals over time by tracking the bio-logging sensors attached to animals (Kranstauber et al., 2011). The data sets were separated into two data files and provided by .csv format. The following are the variables in each data.  

- The `individual` data comes from _Mountain caribou in British Columbia-reference-data.csv_. The data contains the relevant information of 286 caribou. The variables are showing in the following table: 

```{r individual_table, echo=FALSE}
individual_info <- tibble(Variable = c("animal_id", "sex", "life_stage", "pregnant", "with_calf", 
                                       "death_cause", "study_site", "deploy_on_longitude", 
                                       "deploy_on_latitude", "deploy_on_comments", "deploy_off_longitude",
                                       "deploy_off_latitude", "deploy_off_type", "deploy_off_comments"),
                          Class = c("character", "character", "character", 
                                    "logical", "logical", "character", "character", 
                                    "double", "double", "character", "double", 
                                    "double", "character", "character"),
                          Description = c("Individual identifier for animal", "Sex of animal", 
                                          "Age class (in years) at beginning of deployment", 
                                          "Whether animal was pregnant at beginning of deployment", 
                                          "Whether animal had a calf at time of deployment", 
                                          "Cause of death",
                                          "Deployment site or colony, or a location-related group such as the herd or pack name",
                                          "Longitude where animal was released at beginning of deployment",
                                          "Latitude where animal was released at beginning of deployment",
                                          "Additional information about tag deployment",
                                          "Longitude where deployment ended",
                                          "Latitude where deployment ended",
                                          "Classification of tag deployment end (see table below for full description", 
                                          "Additional information about tag deployment end")) 

kable(individual_info) %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "left")
```

- The `location` comes from _Mountain caribou in British Columbia-gps.csv_. The data contains location information of each counted caribous for every 4 fours.

```{r locations_table, echo=FALSE}
locations_info <- tibble(Variable = c("event_id", "animal_id", "study_site", "season", "timestamp", "longitude", "latitude"),
                          Class = c("double", "character", "character", "character", "datetime", "double", "double"),
                          Description = c("Identifier for an individual measurement", 
                                          "Individual identifier for animal", 
                                          "Deployment site or colony, or a location-related group such as the herd or pack name", 
                                          "Season (Summer/Winter) at time of measurement", 
                                          "Date and time of measurement",
                                          "Longitude of measurement",
                                          "Latitude of measurement")) 

kable(locations_info) %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "left")
```

```{r read_data}
# Get the Data

individuals <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-23/individuals.csv')
locations <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-23/locations.csv')

# Or read in with tidytuesdayR package (https://github.com/thebioengineer/tidytuesdayR)

# Either ISO-8601 date or year/week works!

# Install via devtools::install_github("thebioengineer/tidytuesdayR")

tuesdata <- tidytuesdayR::tt_load('2020-06-23')
tuesdata <- tidytuesdayR::tt_load(2020, week = 26)


individuals <- tuesdata$individuals
```
## Data cleaning processes
The data being used is the dataset from the Science update for the South Peace Northern Caribou (Rangifer tarandus caribou pop. 15) in British Columbia available from Movebank (BC Ministry of Environment, 2014). The raw datasets are first read by using read_csv() function. It can be noticed from the raw datasets that the variable names use “-“ instead of “_”. Using dash in a variable name might result to issues, as the valid variable name in R should consist of dot or underline characters. Another problem from this dataset is the values in the “animal-life-stage” consist of spacing, which might lead to issues as it is inconsistent. Another noticeable thing is the datasets have a lot of NA values. Therefore, the data needs to be cleaned by using the tidyverse and janitor libraries.

To clean the individuals data, firstly clean_names() function from the janitor package is used to return the data.frame with clean names.  What this function does is changing the variable names into a tidier form. As mentioned before, using dash in variable names is not appropriate in R. Notice that the raw dataset has names like “deploy-off-latitude” which is changed into “deploy_off_latitude”.  Next is to assigned the result to transmute(), which will compute new columns but will drop existing columns. This is done to make the variable names in a tidier way. The whitespace in the life stage is gotten rid to address inconsistent spacing by using str_remove_all() function. After tidying the variable names with transmute, the “reproductive_condition” variable is separated into “pregnant” and “with_calf” by using the separate() function as this variable actually contains two dimensions, and then assigning those variables into new columns by using the mutate() function which consists of either TRUE or FALSE value.

The locations data is cleaned by using the same method as the individuals data, which includes cleaning the name first by using clean_names() function to arrive to a data.frame with clean names. The next step is to use transmute() function to compute new columns with dropping existing columns. After cleaning both datasets, the final datasets are written into csv format by using write_csv() function.

```{r data_cleaning, eval=FALSE}
# Load libraries
library(tidyverse)
library(janitor)

# Import data
individuals_raw <- read_csv("./caribou-location-tracking/raw/Mountain caribou in British Columbia-reference-data.csv")
locations_raw <- read_csv("./caribou-location-tracking/raw/Mountain caribou in British Columbia-gps.csv")

# Clean individuals
individuals <- individuals_raw %>%
  clean_names() %>%
  transmute(animal_id,
            sex = animal_sex,
            # Getting rid of whitespace to address inconsistent spacing
            # NOTE: life stage is as of the beginning of deployment
            life_stage = str_remove_all(animal_life_stage, " "),
            reproductive_condition = animal_reproductive_condition,
            # Cause of death "cod" is embedded in a comment field
            death_cause = str_remove(animal_death_comments, ".*cod "),
            study_site,
            deploy_on_longitude,
            deploy_on_latitude,
            # Renaming to maintain consistency "deploy_on_FIELD" and "deploy_off_FIELD"
            deploy_on_comments = deployment_comments,
            deploy_off_longitude,
            deploy_off_latitude,
            deploy_off_type = deployment_end_type,
            deploy_off_comments = deployment_end_comments) %>%
  # reproductive_condition actually has two dimensions
  separate(reproductive_condition, into = c("pregnant", "with_calf"), sep = ";", fill = "left") %>%
  mutate(pregnant = str_remove(pregnant, "pregnant: ?"),
         with_calf = str_remove(with_calf, "with calf: ?")) %>%
  # TRUE and FALSE are indicated by Yes/No or Y/N
  mutate_at(vars(pregnant:with_calf), ~ case_when(str_detect(., "Y") ~ TRUE,
                                                   str_detect(., "N") ~ FALSE,
                                                   TRUE ~ NA))

# Clean locations
locations <- locations_raw %>%
  clean_names() %>%
  transmute(event_id,
            animal_id = individual_local_identifier,
            study_site = comments,
            season = study_specific_measurement,
            timestamp,
            longitude = location_long,
            latitude = location_lat)

# Write to CSV
write_csv(individuals, "./caribou-location-tracking/individuals.csv")
write_csv(locations, "./caribou-location-tracking/locations.csv")
```

## Possible questions
This dataset is primarily used to analyse the changes in the number of caribou from 1988 to 2016 to observe the survival of the species. As the management came up with a plan, we would like to analyse whether the management plan is effective in increasing the number of caribou over time.

The primary question to answer from this dataset is __how is the trend of the number of caribou over time?__

From the primary question, we came up with four secondary questions, which are as follows:
- What can we learn about the population change and sex ratio of the caribou?  
- Does the location vary between summer and winter?  
- How is the trend of the classification of tag deployment end (deploy_off_type)?  
- Has the management plan increased the number of caribou?  

# Analysis and findings

[FILL] Should include at least one plot or numerical summary for each of your questions, that helps the reader arrive at an answer. You should also write paragraphs describing the methods, summaries and findings. 

## Question 3: How is the trend of the classification of tag deployment end (deploy_off_type)? What is the highest cause of dead?

•	By analysing the classification of tag deployment end to decided whether the management plan is efficient to increase the number of caribou and whether have to modify the tracking method, such as if there is a large proportion of tag deployment end due to the equipment failure, they have to decided to improve the quality of the tag.

In order to answer this question, the individuals dataset is grouped according to the deploy_off_type and then summarised by counting the number of data for each deploy_off_type. To visualise the data, a bar chart is created by using the ggplot() and geom_col() function. 

```{r deploy-off-type, fig.cap="Distribution of the classification of tag deployment end.", fig.align = "center", fig.width=6}
deploy_type <- individuals %>%
  group_by(deploy_off_type) %>%
count(deploy_off_type) %>%
  ggplot(aes(x = reorder(deploy_off_type, -n),
             y = n)) +
  geom_col(aes(fill = deploy_off_type)) +
  ggtitle("Classification of tag deployment end") +
  xlab("Tag deployment end type") +
  ylab("Total number")  +
  theme(axis.text.y = element_text(size = 12, color = "black", hjust = 1),
        plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
        plot.title.position = "plot")

ggplotly(deploy_type)
```
(change the legend title? + benerin format title etc) 

It can be seen from figure \@ref(fig:deploy-off-type) that out of all the deploy_off_type stated in the data description, there are only four types available in the dataset, which are dead, removal, other and unknown. The highest number of type, with 99, is unknown, which indicates that there was no proper tracking and documentation. The second highest type is removal, which means that the tag was purposefully removed from the animal. Following removal is dead with 60, which is still a lot. The least number of type is other, which might consist of other deployment end types.

As there are several data with dead as the deployment end type, we are looking at the cause of death of caribou in more details. It is important to look at the cause of death as understanding the cause of death of the caribou would allow further monitoring of the caribou to minimise their death. To analyse the cause of death, the individuals dataset is wrangled by filtering the deploy_off_type. As there are some NAs in the death_cause column, the NAs are removed. 

And then a bar plot is created and reordered by the number of the death_cause occuring in the data. 

```{r wrangling-data-q3, include=FALSE, message=FALSE, warning=FALSE}
individuals_dead <- individuals %>%
  filter(deploy_off_type == "dead")

#there are some NAs in the death_cause column, thus we omit all the NA from the data
individuals_dead <- individuals_dead %>%
  drop_na(death_cause)

#As "Unknown.  Found 50m from TREND open pit mine.  Area littered with rock from blasts from the mine." is too long, we change the name to just "Unknown. Open pit mine."

individuals_dead$death_cause[individuals_dead$death_cause == "Unknown.  Found 50m from TREND open pit mine.  Area littered with rock from blasts from the mine."] <- "Unknown. Open pit mine"

#Unknown.  Suspected wolf (or possibly wolverine) predation is also changed to "Unknown. Suspected wolf predation" to match up with the others.

individuals_dead$death_cause[individuals_dead$death_cause == "Unknown.  Suspected wolf (or possibly wolverine) predation"] <- "Unknown.  Suspected wolf predation"

#also, there are some values that has "." at the end, which makes it creates different category for it, thus we get rid of the "."
individuals_dead$death_cause[individuals_dead$death_cause == "Unknown.  Suspected wolf predation."] <- "Unknown.  Suspected wolf predation"

#Predation - Grizzly is the same as Predation - Grizzly bear
individuals_dead$death_cause[individuals_dead$death_cause == "Predation - Grizzly"] <- "Predation - Grizzly Bear"

individuals_dead$death_cause[individuals_dead$death_cause == "Collar still in Field"] <- "Collar Still in Field"
```

```{r plot-death, fig.cap = "Total number of death caused by each cause of death.", fig.align= "center"}
plot_death <- individuals_dead %>%
  group_by(death_cause) %>%
  count(death_cause) %>%
  ggplot(aes(x = reorder(death_cause, n), y = n, fill = death_cause)) +
  geom_col() +
  coord_flip() +
  theme(legend.position = "none") +
  ggtitle("Distribution of death per cause of death") +
  xlab("Cause of death") +
  ylab("Total number of death") +
  theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
        plot.title.position = "plot")

ggplotly(plot_death)
```

It can be seen from figure \@ref(fig:plot-death) that the highest number of cause of death is predation by wolf, which is 18 deaths, if the suspected predation ones are included. The other substantial part of the cause of death includes predation by bear or predation by unknown animals, which concludes that the majority of the death of the caribou was due to predation with around 30% of the total death. The other causes such as vehicle collision, train collision, and accidentals are only partaking a very small part of the death causes.
However, there is also a significant amount of unknown which indicates that monitoring and documentation is not really good.

What we can learn from the analysis is that the majority cause of calf mortality is predation, primarily by wolf, and it is important to take this into consideration when the management are developing plans to increase the number of caribou. The seasonal habitat change that is compromising spatial separation between caribou and the predators can increase the risk of predation. Grey wolves normally live in low elevations, however they occasionally hunt at higher elevations where caribou live (https://www2.gov.bc.ca/assets/gov/environment/plants-animals-and-ecosystems/wildlife-wildlife-habitat/caribou/science_update_final_from_web_jan_2014.pdf). Another reason for the increasing encounter rate of caribou by wolves is the development of linear features such as pipelines and roads which facilitates rapid and widespread movements of wolves (McKenzie et al., 2012).


## Question 4: Has the management plan increased the number of caribou?

According to the Peace Northern Caribou Plan endorsed in November 2012, the goal is to increase the South Peace Northern Caribou to 1,200 animals within 21 years, which has been articulated in implementation plans. Therefore, we are analysing whether the management plan has increased the number of caribou by looking at the number of caribou in the dataset.

```{r wrangling-locations, include=FALSE, message=FALSE, warning=FALSE}
locations_wrangled <- locations %>%
  mutate(month = month(timestamp),
         day = day(timestamp),
         date = date(timestamp),
         year = year(timestamp)) %>%
  select(month,
         day,
         date,
         year,
         animal_id,
         study_site)
locations_summary <- locations_wrangled %>% 
  group_by(year) %>%
  summarise(animals = unique(animal_id))

numbercaribou <- locations_summary %>%
  group_by(year) %>%
  summarise(total = n())
```

```{r number-caribou, fig.cap="The trend of the number of caribou per year.", fig.align= "center"}
trendnumber <- numbercaribou %>%
  ggplot(aes(x = year,
             y = total)) +
  geom_line() +
  ggtitle("Trend of number of caribou yearly") +
  xlab("Year") +
  ylab("Total number of caribou")  +
  theme(axis.text.y = element_text(size = 12, color = "black", hjust = 1),
        plot.title = element_text(size = 14, face = "bold", hjust= "center"),
        plot.title.position = "plot")

ggplotly(trendnumber)
```
Figure \@ref(fig:number-caribou) presents the trend of the number of caribou yearly according to the locations dataset. It can be noticed that the number of caribou fluctuated overtime. It declined by a significant amount in 2001, however the number increased sharply again in 2002 and 2003, and declined again in 2006. The peak was at 2008, where the number of caribou reached 70, which is more than double the number of caribou in 2006. After 2008, the number decreased again. The management plan which was started to be implemented in 2012 seems to be ineffective as the number of caribou still ranges at around 20-30 caribou.

Next, we are looking at the number of caribou's trend yearly in more details by looking at the trend per study_site. 

```{r wrangling-study-site, include=FALSE, warning=FALSE, message=FALSE}
joined_data <- locations_summary %>%
  left_join(individuals, by = c("animals" = "animal_id"))  %>% 
  select(year,
         animals,
         study_site)

joined_summary <- joined_data %>%
  group_by(year, study_site) %>%
  summarise(number = n())
```


```{r number-study-site, fig.cap= "Trend of number of caribou per year according to the study site.", fig.align="center"}
study_site_trend <- joined_summary %>%
  ggplot(aes(x = year,
             y = number,
             group = study_site,
             colour = study_site)) +
  geom_line() +
  ggtitle("Trend of number of caribou yearly by study site") +
  xlab("Year") +
  ylab("Total number of caribou") +
  theme(axis.text.y = element_text(size = 12, color = "black", hjust = 1),
        plot.title = element_text(size = 14, face = "bold"),
        plot.title.position = "plot")

ggplotly(study_site_trend)
```
Figure \@ref(fig:number-study-site) above is showing the changes in the number of caribou yearly based on the study site. The most noticeable thing here is that not all study sites are being recorded every year, and that the trend of number of caribou varies over the study site. From 1988 to 2001, the only study site being recorded was Hart Ranges, in where there was a huge drop between this period. Most of the other study sites started to be recorded since 2002, except for Scott which started in 2013. Most of the study sites are showing a sharp decline in the number of caribou in 2010, which explains the huge drop in the overall trend mentioned before. The number of caribou in Narraway is super low which is due to the herds that are living in this site tend to stay in the lower-elevation area during summer, thus are more exposed to predation risk. Looking at the number of caribou from 2012, there has not been any significant changes in the number of caribou. Therefore, it appears that the management plan has not increased the number of caribou.

So to answer whether the management plan has increased the number of caribou, it appears that the management plan has not increased the number of caribou. And it is unlikely that the number of caribou would increase by that much in 2021. However, this analysis might not be accurate as there are some limitations associated with this analysis. Firstly, some study sites were only being monitored for certain years, which results to inaccurate result to analyse the trend of number of caribou. Secondly, there might be some caribou that were not tracked in certain years as we are calculating the number of caribou per year by using the documented locations data. It might not be an accurate analysis as there might be some caribou that were not tracked in certain years, or that the locations were not being documented inside the locations dataset.


# References
